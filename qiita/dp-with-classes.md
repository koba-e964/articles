https://kmyk.github.io/cp-unspoiler/?q=aHR0cHM6Ly9hdGNvZGVyLmpwL2NvbnRlc3RzL2FyYzE3Ni90YXNrcy9hcmMxNzZfZA%3D%3D から例題。
<details><summary>ネタバレ (問題へのリンク)</summary>
ARC176-D https://atcoder.jp/contests/arc176/tasks/arc176_d
</details>

dp[x][y] を、P_i = x かつ P_{i+1} = y なる確率とする。このとき、遷移の確率は以下であることが簡単にわかる。

- (a) dp[x][y] -> dp[y][x] ($P_i$ と $P_{i+1}$ を入れ替える): $2/(N(N-1))$
- (b) dp[x][y] -> dp[x][y] ($P_a$ と $P_b$ ($a, b \neq i,i+1$) を入れ替える): $(N-2)(N-3)/(N(N-1))$
- (c) dp[x][y] -> dp[x'][y] ($P_i$ と $P_a$ ($a\neq i$) を入れ替える): $2/(N(N-1))$
- (d) dp[x][y] -> dp[x][y'] (上と同様): $2/(N(N-1))$

これだと状態数が多すぎるのでまとめることを考えたい。以下のようにして**多重度**を定義する。

- 多重度とは同値類の大きさである

状態およびその多重度は以下のようになる。多重度を全部足すと $N(N-1)$ であることに注意。
||$x=A_i$|$x=A_{i+1}$|$x\neq A_i,A_{i+1}$|
|--|--|--|--|
|$y=A_i$|-|多重度 1|多重度 $N-2$|
|$y=A_{i+1}$|多重度 1|-|多重度 $N-2$|
|$y\neq A_i,A_{i+1}$|多重度 $N-2$|多重度 $N-2$|多重度 $(N-2)(N-3)$|

上の表に従ってまとめた状態に対する配列を ep[0][0] から ep[2][2] と呼ぼう。

ここで、多重度などから遷移の性質が決まる。例えば (c) の遷移において、$x, y\neq A_i,A_{i+1}$ のときに dp[x][y] から dp[$A_i$][y] へ遷移することを考える。同値類の上での遷移は ep[2][2] -> ep[0][2] であり、その係数は $N-3$ である。多重度 $(N-2)(N-3)$ の同値類から多重度 $N-2$ の同値類への遷移であり、domain の同値類の各要素からはちょうど 1 本の遷移があるためである。
