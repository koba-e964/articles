```
$ python server.py 
1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
p: 79938156244279490196917570063539966343976157459476321233940429171848106787199
g: 66660761356875726919828279967833176091195706284787636435486590927603284420008
h: 44466765521008176715623609408764237450859969023369800232513568424301429892003
c1: 16776860000244332084040132710826842383815433486056474110987611840531063884646
c2: 17312389444159424432880742499318648086587714590988164668646265834663708400738
```

$\log_g h$ を求めるには $\log_u h$ と $\log_u g$ を求めれば良い。 (ここで、 $u$ は cado-nfs が勝手に決める生成元)

`./cado-nfs.py -dlp -ell (p-1) target=(h) (p)` と `./cado-nfs.py -dlp -ell (p-1) target=(g) (p)` を実行し、 $a_2 / a_1 \pmod{p-1}$ を計算すればそれが答えである。

```bash
./cado-nfs.py -dlp -ell 79938156244279490196917570063539966343976157459476321233940429171848106787198 target=44466765521008176715623609408764237450859969023369800232513568424301429892003 79938156244279490196917570063539966343976157459476321233940429171848106787199

# 同じ ell, p、異なる target に対して実行する。
./installed/bin/cado-nfs.py (前回の実行で教えてもらった一時ファイルの場所) target=66660761356875726919828279967833176091195706284787636435486590927603284420008
```

::: details 実行結果
```console
$ time ./installed/bin/cado-nfs.py -dlp -ell 39969078122139745098458785031769983171988078729738160616970214585924053393599 target=44466765521008176715623609408764237450859969023369800232513568424301429892003 79938156244279490196917570063539966343976157459476321233940429171848106787199

...

Info:API server: Shutting down server
Info:Complete Factorization / Discrete logarithm: Total cpu/elapsed time for entire Discrete logarithm: 2279.02/1572.72
Info:root: CADO_DEBUG is on, data kept in /tmp/cado.i1jt9oq_
Info:root: If you want to compute one or several new target(s), run ./installed/bin/cado-nfs.py /tmp/cado.i1jt9oq_/p75.parameters_snapshot.0 target=<target>[,<target>,...]
Info:root: logbase = 9864698054415101807980118848628032889566114535937230788623576759967959301768
Info:root: target = 44466765521008176715623609408764237450859969023369800232513568424301429892003
Info:root: log(target) = 26111141173836657074373772688926188824319793196585249990104109882942309631554 mod ell
26111141173836657074373772688926188824319793196585249990104109882942309631554

real    26m13.471s
user    26m59.535s
sys     3m9.708s

$ time ./installed/bin/cado-nfs.py /tmp/cado.i1jt9oq_/p75.parameters_snapshot.0 target=66660761356875726919828279967833176091195706284787636435486590927603284420008

...

Info:API server: Shutting down server
Info:Complete Factorization / Discrete logarithm: Total cpu/elapsed time for entire Discrete logarithm: 2368.92/1632.15
Info:root: If you want to compute one or several new target(s), run ./installed/bin/cado-nfs.py /tmp/cado.i1jt9oq_/p75.parameters_snapshot.1 target=<target>[,<target>,...]
Info:root: logbase = 9864698054415101807980118848628032889566114535937230788623576759967959301768
Info:root: target = 66660761356875726919828279967833176091195706284787636435486590927603284420008
Info:root: log(target) = 2180776442776793182028134003512608148750446183707217767951401121937094164886 mod ell
2180776442776793182028134003512608148750446183707217767951401121937094164886

real    0m59.843s
user    1m30.327s
sys     0m8.115s
```

:::

GitHub Codespaces の上では前者は約 26 分、後者は約 1 分で完了した。

なお、元の問題に戻ると、離散対数さえわかれば以下のようにして簡単にフラグが取得できる。

```python
$ python3         
Python 3.12.11 (main, Jun  3 2025, 15:41:47) [Clang 17.0.0 (clang-1700.0.13.3)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> p = 79938156244279490196917570063539966343976157459476321233940429171848106787199
>>> g = 66660761356875726919828279967833176091195706284787636435486590927603284420008
>>> h = 44466765521008176715623609408764237450859969023369800232513568424301429892003
>>> lg = 2180776442776793182028134003512608148750446183707217767951401121937094164886
>>> lh = 26111141173836657074373772688926188824319793196585249990104109882942309631554
>>> pow(h, (p - 1) // 2, p)
79938156244279490196917570063539966343976157459476321233940429171848106787198
>>> pow(g, (p - 1) // 2, p)
79938156244279490196917570063539966343976157459476321233940429171848106787198
>>> lgh = lh * pow(lg, -1, (p - 1) // 2) % ((p - 1) // 2)
>>> pow(g, lgh, p) == h
True
>>> 
>>> c1 = 16776860000244332084040132710826842383815433486056474110987611840531063884646
>>> c2 = 17312389444159424432880742499318648086587714590988164668646265834663708400738
>>> m = c2 * pow(c1, -lgh, p) % p
>>> m
117741614136557025042125087210689522154980137777162415462642813
>>> m.to_bytes(32)
b'\x00\x00\x00\x00\x00\x00IERAE{dummy flag for test}'
```
# 罠
## 小さい例だと動かない
F_7 でまず試そうとして実行しても固まる なんだこれ


## `Number Theory for DLP: Starting` の後 404 が返ってくるんだが
ell = p-1 とすると以下のように進まなくなる:
```
./cado-nfs.py -dlp -ell 79938156244279490196917570063539966343976157459476321233940429171848106787198 target=44466765521008176715623609408764237450859969023369800232513568424301429892003 79938156244279490196917570063539966343976157459476321233940429171848106787199

...

Info:Polynomial Selection (root optimized): Aggregate statistics:
Info:Polynomial Selection (root optimized): Total time: 7.07
Info:Polynomial Selection (root optimized): Rootsieve time: 7.07
Info:Number Theory for DLP: Starting
Info:werkzeug: 127.0.0.1 - - [26/Jun/2025 02:38:04] "GET /workunit HTTP/1.1" 404 -
Info:werkzeug: 127.0.0.1 - - [26/Jun/2025 02:38:06] "GET /workunit HTTP/1.1" 404 -
Info:werkzeug: 127.0.0.1 - - [26/Jun/2025 02:38:08] "GET /workunit HTTP/1.1" 404 -
Info:werkzeug: 127.0.0.1 - - [26/Jun/2025 02:38:13] "GET /workunit HTTP/1.1" 404 -
```

ell を (p-1)/2 にしよう。

# 背景情報
cado-nfs のバージョン
```console
(cado-nfs.venv) @koba-e964 ➜ /workspaces/ctf/cado-nfs (master) $ git log --max-count=1
commit 5f44a4936b014ae34d8e9d7bb636a7c74750a3c1 (grafted, HEAD -> master, origin/master, origin/HEAD)
Author: Emmanuel Thomé <emmanuel.thome@inria.fr>
Date:   Wed Jun 25 12:26:14 2025 +0200

    Merge branch 'las-fix-above-large-prime' into 'master'
    
    las: take into account composite special-q in check_whether_q_above_large_prime_bound
    
    See merge request cado-nfs/cado-nfs!213
```
